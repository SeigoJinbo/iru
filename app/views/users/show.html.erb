<% @organizations = Organization.all.where(description:"....") %>
<div class="page">

	<div class="page-box">
	<%# User banner, avatar, description %>
		<div class="user-banner" style="background-image:linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.2)), url(<%= cl_image_path @user.photos.second.key, height: 200, width: 1200, crop: :fill %>); background-repeat: norepeat; background-size: cover;">
			<div class="user-banner-items d-flex justify-content-around">

				<%= cl_image_tag @user.photos.first.key, height: 100, width: 100, crop: :fill, class: "user-avatar" %>
        <h1><span class="maize-text"><%= @user.nickname %>'s</span> <span class="ivory-text">Profile</span></h1>
        <div class="user-banner-text ml-3 ">

          <div>

          </div>
           <div class='banner-headers d-flex justify-content-between'>
            <div><h2><div>126</div>Items Donationated</h2></div>
            <div><h2><div>38</div>Projects Funded</h2></div>
            <div><h2><div>12</div>Volunteer Events</h2></div>
          </div>

        </div>
			</div>
		</div>

		<div class="user-sections">
			<%# -----------------User Dashboard--------------- %>


<div class="profile-mid d-flex">
  <div class="bio">
    <div>
      <!--------------------------BIO-------------------->
      <h4>bio</h4>
      <p><span><%= @user.gender.capitalize %>, 30 years old</span></p>
      <p><span><%= @user.description %></span></p>
      <p class='d-flex justify-content-end'><%= link_to "Edit", "#"  %></p>
    </div>
    <!--------------------------FRIENDS------------------------------>
    <% @users = [User.find_by(first_name: "Doug"), User.find_by(first_name: "Taku"), User.find_by(first_name: "jess"), User.find_by(first_name: "Alex")] %>

    <div>
      <h4>Friends</h4>
      <div>
        <% @users.each do |user| %>
          <%= cl_image_tag user.photos.first.key, height: 100, width: 100, crop: :fill, class: "avatar" %>
        <% end %>
        <p><%= link_to "View all", "#"  %></p>
      </div>
      <!----------------------CONTRIBUTIONS ------------------------>
      <h4>Contributed towards: 12 Organizations</h4>
      <div>
        <% @organizations[1..4].each do |organization| %>
          <%= cl_image_tag organization.photos.first.key, height: 80, width: 80, crop: :fill, class: "avatar"%>
        <% end %>
        <p><%= link_to "View all", "#"  %></p>
      </div>
    </div>
  </div>
    <!-------------------------FEED------------------------>
  <div class='feed'>
      <h4 class='feed-title'>Feed</h4>
      <div class="feed-scroll">

        <% if @user.last_name.nil? %>

        <div class="feed-comment">
          <div class="feed-comment-content flex-box p-2">
            <div class="d-flex">
            <%= cl_image_tag Organization.find_by(name: "Colabo").photos.first.key, height: 100, width: 100, crop: :fill, class: "avatar" %>
            <p class="mt-2 ml-2">Collabo</p>
            </div>
          </div>
          <img src=https://cdn2.creativecirclemedia.com/ptleader/original/20181126-222144-25178be8b550118fe3b27f41b6b7a6b0.jpg width="500" alt="">
          <p class='ml-3 p-3'>We used your blankets!</p>
        </div>

        <% else %>

        <div class="feed-comment">
          <div class="feed-comment-content flex-box p-2">
            <div class="d-flex">
            <%= cl_image_tag Organization.find_by(name: "Colabo").photos.first.key, height: 100, width: 100, crop: :fill, class: "avatar" %>
            <p class="mt-2 ml-2">Collabo</p>
            </div>
          </div>
          <img src=https://media.pri.org/s3fs-public/styles/open_graph/public/japan-tsunami-aid-effort-2011-03-17.jpg?itok=F3RNopiP width="500" alt="">
          <p class='ml-3 p-3'>Mitsuki really enjoyed your blanket!</p>
        </div>

        <% end %>

        <div class="feed-comment">
          <div class="feed-comment-content flex-box p-2">
            <div class="d-flex">
              <%= cl_image_tag Organization.find_by(name: "Mirai no Mori").photos.first.key, height: 100, width: 100, crop: :fill, class: "avatar" %>
              <p class="mt-2 ml-2">Mirai no Mori</p>
            </div>
          </div>
          <img src="https://resources.realestate.co.jp/wp-content/uploads/2020/01/volunteering-tokyo-park-cleanup-1020x500.jpg" width="500" alt="">

          <p class='ml-3 p-3'>Thanks for helping out!</p>
        </div>

        <div class="feed-comment">
          <div class="feed-comment-content flex-box p-2">
            <div class="d-flex">
              <%= cl_image_tag Organization.find_by(name: "World Wildlife Day ").photos.first.key, height: 100, width: 100, crop: :fill, class: "avatar" %>
              <p class="mt-2 ml-2">World Wildlife Day</p>
            </div>
          </div>
          <img src="https://static.fox29.com/www.fox29.com/content/uploads/2019/06/PSPCA_dog_generic_01.jpg" width="500" alt="">
          <p class='ml-3 p-3'>The dog you saved had puppies!</p>
        </div>

        <div class="feed-comment">
          <div class="feed-comment-content flex-box p-2">
            <%= cl_image_tag current_user.photos.first.key, height: 100, width: 100, crop: :fill, class: "avatar" %>
            <%= current_user.nickname %>
          </div>
        <p class='ml-3 p-3'>thanks for your contribution!</p>
        </div>
      </div>
  </div>


  <div class='contributed'>
      <h4>Contributed towards: 23 Organizations</h4>
    <div class='contributed-scroll'>
      <div>
          <% @organizations[1..4].each do |organization| %>
          <%= cl_image_tag organization.photos.first.key, height: 80, width: 80, crop: :fill %>
              <%=organization.name %>
              <% end %>
              <%= link_to "View all", "#"  %>
      </div>
    </div>
  </div>
</div>













<!------------------------------BADGE--------------------------------->
  <div class='badges'>
    <h3>Badges</h3>
    <div class="d-flex justify-content-around">
      <%= image_tag "b-1.png", class: "map-results-organization-image" %>
      <%= image_tag "b-2.png", class: "map-results-organization-image" %>
      <%= image_tag "b-3.png", class: "map-results-organization-image" %>
      <%= image_tag "b-4.png", class: "map-results-organization-image" %>
      <%= image_tag "b-5.png", class: "map-results-organization-image" %>
      <%= image_tag "b-6.png", class: "map-results-organization-image" %>



    </div>



  </div>







			<% if current_user == @user %>
				<div class="events">
					<h3>My Events</h3>
					<div class="user-box">

						<% if @current_enrollments.any? %>
							<%  @current_enrollments.each do |enrollment| %>
								<% if enrollment.event.category == "Volunteer" %>
									<li class="event-card">
										<div class="event-card-contents">
											<%= link_to event_path(enrollment.event) do  %>
												<div class="event-card-pic" style="background-image:linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.2)), url(<%= cl_image_path enrollment.event.photo.key, height: 240, width: 360, crop: :fill %>); background-repeat: norepeat; background-size: cover;">
													<h4><%= enrollment.event.title %></h4>
												</div>
												<div class="card-info">
													<p><i class="far fa-calendar-alt"></i> <%= enrollment.event.start_time.strftime("%d of %B, %Y") %></p>
													<p><i class="far fa-clock"></i> <%= enrollment.event.start_time.strftime("%I:%M %p")%> - <%= enrollment.event.end_time.strftime("%I:%M %p")%></p>
													<p>Volunteers: <%= enrollment.event.enrollments.where(status: "Approved").count %>/<%= enrollment.event.target %> people</p>
													<%# status badge!! %>
													<h6 class='status-badge-<%=enrollment.status%>'><%=enrollment.status%></h6>
													<%# status badge!! %>
													<div>
														<% enrollment.event.enrollments.where(status: "Approved").each do |enrollment| %>
															<%= link_to user_path(enrollment.user) do %>
																<%= cl_image_tag enrollment.user.photos.first.key, height: 40, width: 40, crop: :fill , class: "avatar-sm"%>
															<% end %>
														<% end %>
													</div>
													<br>

											</div>
											<% end %>
										</div>
									</li>
								<% elsif enrollment.event.category == "Donation" %>
									<li class="event-card">
										<div class="event-card-contents">
											<%= link_to event_path(enrollment.event) do  %>
												<div class="event-card-pic" style="background-image:linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.2)), url(<%= cl_image_path enrollment.event.photo.key, height: 380, width: 480, crop: :fill %>); background-repeat: norepeat; background-size: cover;">
													<h4><%= enrollment.event.title %></h4>
												</div>
												<div class="card-info">
													<h5><span class="seaweed-text font-weight-bold"><%= (Date.today...event.end_time).count %> days left</span></h5>
													<p><i class="fas fa-bullseye"></i> <%= enrollment.event.target %> <%= enrollment.event.item %></p>
													<p><i class="fas fa-signal"></i> <%= (enrollment.event.raised.to_f / enrollment.event.target.to_f * 100).to_i %>% collected</p>

													<div class="card-meter mt-2">
														<% if enrollment.event.raised.nil? %>
															<span style="width:0%;"><span class="card-progress"></span></span>
														<% else %>
															<% if enrollment.event.category == "Volunteer" %>
																<% raised_amount = ((enrollment.event.enrollments.where(status: "Approved").count.to_f / enrollment.event.target.to_f) * 100).to_i %>
															<% else %>
																<% raised_amount = ((enrollment.event.raised.to_f / enrollment.event.target.to_f) * 100).to_i %>
															<% end %>
																<span style="width:<%= raised_amount %>%;"><span class="card-progress"></span></span>
														<% end %>
														<%# status badge!! %>
														<h6 class='status-badge-<%=enrollment.status%>'><%=enrollment.status%></h6>
														<%# status badge!! %>
													</div>
												</div>
											<% end %>
										</div>
									</li>
								<% elsif enrollment.event.category == "Fundraiser" %>
									<li class="event-card">
										<div class="event-card-contents">
											<%= link_to event_path(enrollment.event) do  %>
												<div class="event-card-pic" style="background-image:linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.2)), url(<%= cl_image_path enrollment.event.photo.key, height: 380, width: 480, crop: :fill %>); background-repeat: norepeat; background-size: cover;">
													<h4><%= enrollment.event.title %></h4>
												</div>
												<div class="card-info">
													<h5><span class="seaweed-text font-weight-bold"><%= (Date.today...enrollment.event.end_time).count %> days left</span></h5>
													<p><i class="fas fa-hand-holding-usd"></i> <%= humanized_money_with_symbol(enrollment.event.raised) %> / <%= humanized_money_with_symbol(enrollment.event.target) %></p>
													<p><i class="fas fa-signal"></i> <%= (enrollment.event.raised.to_f / enrollment.event.target.to_f * 100).to_i %>% collected</p>

													<div class="card-meter mt-2">
														<% if enrollment.event.raised.nil? %>
															<span style="width:0%;"><span class="card-progress"></span></span>
														<% else %>
															<% if enrollment.event.category == "Volunteer" %>
																<% raised_amount = ((enrollment.event.enrollments.where(status: "Approved").count.to_f / enrollment.event.target.to_f) * 100).to_i %>
															<% else %>
																<% raised_amount = ((enrollment.event.raised.to_f / enrollment.event.target.to_f) * 100).to_i %>
															<% end %>
																<span style="width:<%= raised_amount %>%;"><span class="card-progress"></span></span>
														<% end %>
														<%# status badge!! %>
														<h6 class='status-badge-<%=enrollment.status%>'><%=enrollment.status%></h6>
														<%# status badge!! %>
													</div>
												</div>
											<% end %>
										</div>
									</li>
								<% end %>
							<% end %>
						<% else %>
							<p>None yet! <%= link_to "Find an organization?", map_path %></p>
						<% end %>
					</div>
				</div>
			<% end %>
			</div>

			<div class="user-profile">
			<%# -------------Organizations------------------%>
				<div class="organizations-history">
					<% if current_user == @user %>
						<h3>My Organizations</h3>
					<% else %>
						<h3><%= @user.nickname %>'s Organizations</h3>
					<% end %>
						<div class="user-box">
							<% @user.organizations.each do |organization| %>
								<li class="event-card">
									<div class="event-card-contents">
										<%= link_to organization_path(organization) do  %>
											<div class="event-card-pic" style="background-image:linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.2)), url(<%= cl_image_path organization.photos.first.key, height: 240, width: 360, crop: :fill %>); background-repeat: norepeat; background-size: cover;">
												<h4><%= organization.name %></h4>
											</div>
											<div class="card-info">
												<h6><%= organization.tag_list %></h6>
												<p><%= organization.description.truncate(90, separator: ' ') %></p>
											</div>
										<% end %>
									</div>
								</li>
							<% end %>
						</div>
				</div>

				<div class="organizations-history">
					<h3>Volunteering History</h3>
					<div class="user-box" id="history-box">
						<% if @past_enrollments.any? %>
							<% @past_enrollments.each do |enrollment| %>
								<% if enrollment.event.category == "Volunteer" %>
									<li class="event-card">
										<div class="event-card-contents">
											<%= link_to event_path(enrollment.event) do  %>
												<div class="event-card-pic" style="background-image:linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.2)), url(<%= cl_image_path enrollment.event.photo.key, height: 240, width: 360, crop: :fill %>); background-repeat: norepeat; background-size: cover;">
													<h4><%= enrollment.event.title %></h4>
												</div>
												<div class="card-info">
													<p><i class="far fa-calendar-alt"></i> <%= enrollment.event.start_time.strftime("%d of %B, %Y") %></p>
													<p><i class="far fa-clock"></i> <%= enrollment.event.start_time.strftime("%I:%M %p")%> - <%= enrollment.event.end_time.strftime("%I:%M %p")%></p>
													<p>Volunteers: <%= enrollment.event.enrollments.where(status: "Approved").count %>/<%= enrollment.event.target %> people</p>
													<div>
														<% enrollment.event.enrollments.where(status: "Approved").each do |enrollment| %>
															<%= link_to user_path(enrollment.user) do %>
																<%= cl_image_tag enrollment.user.photos.first.key, height: 40, width: 40, crop: :fill , class: "avatar-sm"%>
															<% end %>
														<% end %>
													</div>
													<br>
											</div>
											<% end %>
										</div>
									</li>
								<% elsif enrollment.event.category == "Donation" %>
									<li class="event-card">
										<div class="event-card-contents">
											<%= link_to event_path(enrollment.event) do  %>
												<div class="event-card-pic" style="background-image:linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.2)), url(<%= cl_image_path enrollment.event.photo.key, height: 380, width: 480, crop: :fill %>); background-repeat: norepeat; background-size: cover;">
													<h4><%= enrollment.event.title %></h4>
												</div>
												<div class="card-info">
													<h5><span class="seaweed-text font-weight-bold"><%= (Date.today...event.end_time).count %> days left</span></h5>
													<p><i class="fas fa-bullseye"></i> <%= enrollment.event.target %> <%= enrollment.event.item %></p>
													<p><i class="fas fa-signal"></i> <%= (enrollment.event.raised.to_f / enrollment.event.target.to_f * 100).to_i %>% collected</p>

													<div class="card-meter mt-2">
														<% if enrollment.event.raised.nil? %>
															<span style="width:0%;"><span class="card-progress"></span></span>
														<% else %>
															<% if enrollment.event.category == "Volunteer" %>
																<% raised_amount = ((enrollment.event.enrollments.where(status: "Approved").count.to_f / enrollment.event.target.to_f) * 100).to_i %>
															<% else %>
																<% raised_amount = ((enrollment.event.raised.to_f / enrollment.event.target.to_f) * 100).to_i %>
															<% end %>
																<span style="width:<%= raised_amount %>%;"><span class="card-progress"></span></span>
														<% end %>
													</div>
												</div>
											<% end %>
										</div>
									</li>
								<% elsif enrollment.event.category == "Fundraiser" %>
									<li class="event-card">
										<div class="event-card-contents">
											<%= link_to event_path(enrollment.event) do  %>
												<div class="event-card-pic" style="background-image:linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.2)), url(<%= cl_image_path enrollment.event.photo.key, height: 380, width: 480, crop: :fill %>); background-repeat: norepeat; background-size: cover;">
													<h4><%= enrollment.event.title %></h4>
												</div>
												<div class="card-info">
													<h5><span class="seaweed-text font-weight-bold"><%= (Date.today...enrollment.event.end_time).count %> days left</span></h5>
													<p><i class="fas fa-hand-holding-usd"></i> <%= humanized_money_with_symbol(enrollment.event.raised) %> / <%= humanized_money_with_symbol(enrollment.event.target) %></p>
													<p><i class="fas fa-signal"></i> <%= (enrollment.event.raised.to_f / enrollment.event.target.to_f * 100).to_i %>% collected</p>

													<div class="card-meter mt-2">
														<% if enrollment.event.raised.nil? %>
															<span style="width:0%;"><span class="card-progress"></span></span>
														<% else %>
															<% if enrollment.event.category == "Volunteer" %>
																<% raised_amount = ((enrollment.event.enrollments.where(status: "Approved").count.to_f / enrollment.event.target.to_f) * 100).to_i %>
															<% else %>
																<% raised_amount = ((enrollment.event.raised.to_f / enrollment.event.target.to_f) * 100).to_i %>
															<% end %>
																<span style="width:<%= raised_amount %>%;"><span class="card-progress"></span></span>
														<% end %>
													</div>
												</div>
											<% end %>
										</div>
									</li>
								<% end %>
							<% end %>
						<% else %>
							<p>None yet!</p>
						<% end %>
					</div>
				</div>
				<%# Interests etc. %>
				<%# <div class="interests"></div> %>
				<%# <div class="badges"></div> %>
				</div>
			</div>
		</div>
	</div>
</div>
