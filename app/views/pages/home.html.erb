<div class="page">
  <div class="home-banner" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('https://i.imgur.com/6clFprt.jpg')">
    <div class="home-text">
			<h1>iru</h1>
			<h2>Contribute to a cause near you</h2>
			<div class="home-button"><%= link_to "Explore your community", map_path, class: 'btn btn-primary m-3' %></div>
		</div>
  </div>

<% @organizations = Organization.all.where(description: "....").uniq { |organization| organization.name } %>
<% @events = Event.all.order("id ASC").select {|event| event.organization.description == "...."} %>
<% @event = Event.first %>

<div class="page-box d-flex justify-content-around">

<div class='m-4'>
  <div class="ml-4">
  <h2>Featured Project</h2>
    <%= cl_image_tag @event.photo.key, height: 380, width: 540, crop: :fill, class: "org-avatar" %>
    <div class="d-flex justify-content-between mt-2">
    <h3><%= @event.title %></h3>
    <p><i class="fas fa-map-marker-alt"></i> <%= @event.address %></p>
    </div>


    <% if @event.raised.nil? %>
      <h3><span class="maize-text">¥0</span> out of ¥<%= @event.target %> raised</h3>
    <% else %>
      <h3><span class="maize-text"><%= humanized_money_with_symbol(@event.raised) %></span> out of <%= humanized_money_with_symbol(@event.target) %> raised</h3>
    <% end %>

    <div class="meter">
      <% if @event.raised.nil? %>
        <span style="width:0%;"><span class="progress"></span></span>
      <% else %>
        <% if @event.category == "Volunteer" %>
          <% raised_amount = ((@event.enrollments.where(status: "Approved").count.to_f / @event.target.to_f) * 100).to_i %>
        <% else %>
          <% raised_amount = ((@event.raised.to_f / @event.target.to_f) * 100).to_i %>
        <% end %>
          <span style="width:<%= raised_amount %>%;"><span class="progress"></span></span>
      <% end %>
    </div>

    <div class="d-flex justify-content-between">
      <div class='d-flex'>
        <p><%= cl_image_tag @event.organization.photos.first.key, height: 80, width: 80, crop: :fill, class: "org-avatar-home" %></p>
        <h5 class='mt-4 ml-2'><%= @event.organization.name %></h5>
      </div>

      <div>
        <% if Time.now < @event.end_time %>
          <% remaining_days =(Date.today...@event.end_time).count %>
          <% if remaining_days < 2 %>
            <h4><%= (remaining_days * 24).round %> hours left!</h4>
          <% else %>
            <h4><%= remaining_days.round %> days left</h4>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>


<div class='m-4'>
  <div class="mr-4">
  <h2>Recommended Projects</h2>
    <div class='recommended'>
        <%  @events[1..4].each do |event| %>
          <div class='m-1'>
            <%= cl_image_tag event.photo.key, height: 180, width: 280, crop: :fill, class: "org-avata-home-event" %>
            <div class="d-flex justify-content-between">
            <p><%= event.title %></p>
            <p class='recommended-address'><i class="fas fa-map-marker-alt"></i> <%= event.address %></p>
            </div>
            <div class="d-flex justify-content-between">
              <div class="d-flex">
                <%= cl_image_tag event.organization.photos.first.key, height: 32, width: 32, crop: :fill, class: "org-avatar-home" %>
                <p class='text-center'><%= event.organization.name %></p>
              </div>
              <p class='recommended-address'><%= event.tag_list %></p>
            </div>
          </div>
        <% end %>
    </div>
  </div>
</div>

</div>

<div class="page-box-home">
  <h2 class="ml-4">Top Organizations</h2>
  <div class='page-box-home-info d-flex m-4'>
    <% @organizations.each do |organization| %>
      <div class='m-3'>
        <%= cl_image_tag organization.photos.first.key, height: 160, width: 160, crop: :fill, class: "org-avatar" %>
        <p><%= organization.name %></p>
      </div>
    <% end %>
  </div>
</div>
