<% day_of_the_week = ["Monday", "Tuesday", "Wednesday", "Thrusday", "Friday", "Saturday", "Sunday"] %>
members of this org
<div class="page">
  <div class="page-box">
    <h1><%= @organization.name %></h1>
    <p><%= @organization.description %></p>

    <% @organization.events.each do |event| %>
      <div class="d-flex">
        <h5><%= link_to event.title, organization_path(event.organization) %></h5>
        <% event.enrollments.each do |enrollment| %>
          <div>
          <%= link_to user_path(enrollment.user) do  %>
            <p><%= enrollment.user.nickname %></p>
            <%= cl_image_tag enrollment.user.photos.first.key, height: 60, width: 60, crop: :fill %>
          <% end %>
            <p><%= enrollment.start_time %></p>
            <p><%= enrollment.end_time %></p>
            <%= enrollment.status %>
            <%= simple_form_for(enrollment) do |f| %>
              <%= f.input :status, as: :hidden, remote: true, input_html: { value: "Approved" } %>
              <div class="m-1"><%= f.submit 'Approve', class: 'btn btn-primary'%></div>
            <% end %>
            <%= simple_form_for(enrollment) do |f| %>
              <%= f.input :status, as: :hidden, remote: true, input_html: { value: "Declined" } %>
              <div class="m-1"><%= f.submit 'Decline', class: 'btn btn-primary'%></div>
            <% end %>
          </div>
         <% end %>
       </div>
    <% end %>
    <div class="org-info">
      <ul>
        <li>Adress: <%= @organization.address %></li>
        <li>Email: <%= @organization.email %></li>
        <li>Phone Number: <%= @organization.phone_number %></li>
        <li>Establishment Year: <%= @organization.establishment_year %></li>
        <li>HP Url: <%= @organization.hp_url %></li>
        <li>FB Url: <%= @organization.fb_url %></li>
        <li>Twitter Url: <%= @organization.twitter_url %></li>
        <li>Insta Url: <%= @organization.insta_url %></li>
      </ul>
    </div>
    <br>
    <h2>Events</h2>
    <% if @organization.users.include?(current_user) %>
      <%= link_to "Create a new event", new_organization_event_path(@organization), class: 'btn btn-primary' %>
    <% end %>
    <% @organization.events.each do |event| %>
      <h4><%= event.title %></h4>
      <ul>
        <li><%= event.description %></li>
        <li>positions: <%= event.positions %> ppl</li>
        <% if event.dates.present? %>
          <li>Every <% event.dates.each do |date| %>
              <%= day_of_the_week[date] %>
            <% end %></li>
          <li>Start Time: <%= event.start_time.strftime("%k:%M") %></li>
          <li>End Time: <%= event.end_time.strftime("%k:%M") %></li>
        <% else %>
          <li>Start Time: <%= event.start_time.strftime("%d of %B, %Y") %></li>
          <li>End Time: <%= event.end_time.strftime("%d of %B, %Y") %></li>
        <% end %>
      </ul>
      <div class="enroll-section">
        <% if user_signed_in? %>
          <% if event.owner == current_user || current_user.admin %>
            <%= link_to "Edit", event_path(event), class: 'btn btn-primary' %>
            <%= link_to "Delete", event_path(event), class: 'btn btn-primary', method: :delete, data: { confirm: "Delete #{event.title}?" } %>
					<% end %>
          <% if event.owner != current_user || current_user.admin %>
            <button class="enroll-btn btn btn-primary" type="button">Enroll!</button>
            <div class="enroll-form">
              <p>Select the volunteering time:</p>
              <%= simple_form_for [event, @enrollment] do |f| %>
                <%= f.input :start_time, as: :datetime, html5: true %>
                <%= f.input :end_time, as: :datetime, html5: true %>
                <%= f.button :submit, class: "btn btn-primary" %>
              <% end %>
            </div>
          <% end %>
        <% else %>
          <%= link_to "Sign in to enroll", new_user_session_path, class: "btn btn-primary" %>
        <% end %>
      </div>
    <% end %>
  </div>
