<% day_of_the_week = ["Mon", "Tue", "Wed", "Thur", "Fri", "Sat", "Sun"] %>

<%# Org banner %>
<div class="org-banner" style="background-image:linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.2)), url(<%= cl_image_path @organization.photos.second.key, height: 400, width: 1200, crop: :fill %>); background-repeat: norepeat; background-size: cover;">
  <div class="org-banner-items">
    <%= cl_image_tag @organization.photos.first.key, height: 100, width: 100, crop: :fill, class: "org-avatar" %>
    <div class="org-banner-text ml-3">
      <h1><span class="maize-text"><%= @organization.name %> </span> since <%= @organization.establishment_year %></h1>
      <p><span class="ivory-text"><%= @organization.description %></span></p>
      <i class="fas fa-map-marker-alt icon"></i> <span class="ivory-text"><%= @organization.address %></span>
      <i class="fas fa-phone icon"></i><span class="ivory-text"><%= @organization.phone_number %></span>
      <div class="hp-links">
        <i class="fas fa-home"></i>
        <i class="fab fa-facebook-square"></i>
        <i class="fab fa-twitter-square"></i>
        <i class="fab fa-instagram-square"></i>
      </div>
      <% if @organization.users.include?(current_user) %>
        <div class="btn btn-primary edit-btn">Edit Profile</div>
      <% end %>
    </div>
  </div>
</div>
<!---------------------Tabs bar--------------------->
<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" id="event-tab" data-toggle="tab" href="#event" role="tab" aria-controls="event" aria-selected="true">Event</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="calendar-tab" data-toggle="tab" href="#calendar" role="tab" aria-controls="calendar" aria-selected="false">Calendar</a>
  </li>
</ul>
<!---------------------Tabs page--------------------->
<div class="tab-content" id="myTabContent">
  <!---------------------Event tabs--------------------->
  <div class="tab-pane fade show active" id="event" role="tabpanel" aria-labelledby="event-tab">
    <div class="org-sections">
      <div class="event-center"><h2>Events</h2></div>
      <div class="round-box">
        <div class="event-box">

          <!---------------------Volunteer Event--------------------->
          <% @volunteer_events.each do |event| %>
            <li class="event-card">
              <div class="event-card-contents">
                <%= link_to event_path(event) do  %>
                  <div class="event-card-pic" style="background-image:linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.2)), url(<%= cl_image_path event.photo.key, height: 380, width: 480, crop: :fill %>); background-repeat: norepeat; background-size: cover;">
                    <h4><%= event.title %></h4>
                    <p><%= event.description %></p>
                  </div>
                <% end %>
                  <p>Positions: <%= event.positions %> people</p>
                  <% if event.dates.present? %>
                  <div class="dates-btn">
                    <p>Every <% [0, 1, 2, 3, 4, 5, 6].each do |date| %>
                      <% if event.dates.include?(date) %>
                          <div class="btn btn-primary heavy-btn" disabled><%= day_of_the_week[date] %></div>
                        <% else %>
                          <div class="btn btn-outline-primary light-btn" disabled><%= day_of_the_week[date] %></div>
                        <% end %>
                      <% end %></p>
                  </div>
                    <p><%= event.start_time.strftime("%I:%M %p") %> - <%= event.end_time.strftime("%I:%M %p") %></p>
                  <% else %>
                    <p>From üëâüèª <%= event.start_time.strftime("%d of %B, %Y - %I:%M %p") %></p>
                    <p>To üëâüèª <%= event.end_time.strftime("%d of %B, %Y - %I:%M %p") %></p>
                  <% end %>
                <div class="enroll-section">
                  <% if user_signed_in? %>
                    <!-- ------Event owner edit / delete -->
                    <% if event.owner == current_user || current_user.admin %>
                      <%= link_to "Edit", event_path(event), class: 'btn btn-primary' %>
                      <%= link_to "Delete", event_path(event), class: 'btn btn-primary', method: :delete, data: { confirm: "Delete #{event.title}?" } %>
                    <% end %>
                    <!------- Enroll --------->
                    <% if event.owner != current_user || current_user.admin %>
                      <button class="enroll-btn btn btn-primary btn-block" type="button">Enroll!</button>
                      <div class="enroll-form">
                        <p>Select the volunteering time:</p>
                        <%= simple_form_for [event, @enrollment] do |f| %>
                          <%= f.input :start_time, as: :datetime, html5: true %>
                          <%= f.input :end_time, as: :datetime, html5: true %>
                          <%= f.button :submit, class: "btn btn-primary btn-block" %>
                        <% end %>
                      </div>
                    <% end %>
                    <!------ Visitor sign in ------>
                  <% else %>
                    <%= link_to "Sign in to enroll", new_user_session_path, class: "btn btn-primary" %>
                  <% end %>
                </div>
              </div>
            </li>
          <% end %>

          <!---------------------Donation Event--------------------->
          <% @donation_events.each do |event| %>
            <li class="event-card">
              <div class="event-card-contents">
                <%= link_to event_path(event) do  %>
                  <div class="event-card-pic" style="background-image:linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.2)), url(<%= cl_image_path event.photo.key, height: 380, width: 480, crop: :fill %>); background-repeat: norepeat; background-size: cover;">
                    <h4><%= event.title %></h4>
                    <p><%= event.description %></p>
                  </div>
                <% end %>
                    <p>From üëâüèª <%= event.start_time.strftime("%d of %B, %Y - %I:%M %p") %></p>
                    <p>To üëâüèª <%= event.end_time.strftime("%d of %B, %Y - %I:%M %p") %></p>
                <div class="enroll-section">
                  <% if user_signed_in? %>
                    <!-- ------Event owner edit / delete -->
                    <% if event.owner == current_user || current_user.admin %>
                      <%= link_to "Edit", event_path(event), class: 'btn btn-primary' %>
                      <%= link_to "Delete", event_path(event), class: 'btn btn-primary', method: :delete, data: { confirm: "Delete #{event.title}?" } %>
                    <% end %>
                    <!------- Enroll --------->
                    <% if event.owner != current_user || current_user.admin %>
                      <button class="enroll-btn btn btn-primary btn-block" type="button">Donate!</button>
                      <div class="enroll-form">
                        <p>How many <%= event.item %> would you like to donate?</p>
                        <%= simple_form_for [event, @donation] do |f| %>
                          <%= f.input :amount %>
                          <%= f.button :submit, class: "btn btn-primary btn-block" %>
                        <% end %>
                      </div>
                    <% end %>
                    <!------ Visitor sign in ------>
                  <% else %>
                    <%= link_to "Sign in to enroll", new_user_session_path, class: "btn btn-primary" %>
                  <% end %>
                </div>
              </div>
            </li>
          <% end %>


          <!---------------------Fundraiser Event-------------------->
          <% @fundraiser_events.each do |event| %>
            <li class="event-card">
              <h1>Fundraiser</h1>
              <p><%= humanized_money_with_symbol(event.raised) %> / <%= humanized_money_with_symbol(event.target) %></p>
              <p>Amount: <%= humanized_money_with_symbol(event.price) %></p>

              <!---donate form---->
              <%= form_tag orders_path do |f| %>
                <%= hidden_field_tag 'event_id', event.id %>
                 <%= text_field_tag :amount_cents %>

                <%= submit_tag 'Donate', class: 'btn btn-primary' %>
              <% end %>


              <div class="event-card-contents">
                <div class="event-card-pic" style="background-image:linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.2)), url(<%= cl_image_path event.photo.key, height: 380, width: 480, crop: :fill %>); background-repeat: norepeat; background-size: cover;">
                  <h4><%= event.title %></h4>
                  <p><%= event.description %></p>
                </div>
                  <p>Positions: <%= event.positions %> people</p>

                <div class="enroll-section">
                  <% if user_signed_in? %>
                    <!-- --------------Event owner edit / delete --------------------->
                    <% if event.owner == current_user || current_user.admin %>
                      <%= link_to "Edit", event_path(event), class: 'btn btn-primary' %>
                      <%= link_to "Delete", event_path(event), class: 'btn btn-primary', method: :delete, data: { confirm: "Delete #{event.title}?" } %>
                    <% end %>
                    <!----------------------- Enroll --------------------------->
                    <% if event.owner != current_user || current_user.admin %>
                      <button class="enroll-btn btn btn-primary btn-block" type="button">Enroll!</button>
                      <div class="enroll-form">
                        <p>Select the volunteering time:</p>
                        <%= simple_form_for [event, @enrollment] do |f| %>
                          <%= f.input :start_time, as: :datetime, html5: true %>
                          <%= f.input :end_time, as: :datetime, html5: true %>
                          <%= f.button :submit, class: "btn btn-primary btn-block" %>
                        <% end %>
                      </div>
                    <% end %>
                    <!--------------------- Visitor sign in ------------->
                  <% else %>
                    <%= link_to "Sign in to enroll", new_user_session_path, class: "btn btn-primary" %>
                  <% end %>
                </div>
              </div>
            </li>
          <% end %>
        </div>
        <div class="col-6">
          <%= simple_form_for [@organization, @organization_comment] do |f| %>
            <%= f.input :content, label: 'Comment' %>
            <%= f.button :submit, 'Comment', remote: true, class: "btn btn-primary btn-block" %>
          <% end %>
          <% if @organization.organization_comments.any? %>
            <% @organization.organization_comments.each do |comment| %>
              <div class="organization-comment">
                <div class="flex-box p-2">
                  <%= cl_image_tag comment.user.photos.first.key, height: 100, width: 100, crop: :fill, class: "avatar" %>
                  <%= comment.user.nickname %>
                </div>
                <p class='p-2'><%= comment.content%></p>
                <% if current_user == comment.user || @organization.users.include?(current_user)  %>
                  <%= link_to "Delete", organization_comment_path(comment), class: 'btn btn-primary', method: :delete, data: { confirm: "Delete comment?" } %>
                <% end %>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  <!---------------------Calendar tabs--------------------->
  <div class="tab-pane fade" id="calendar" role="tabpanel" aria-labelledby="calendar-tab">
    <div class=calendar-box>
			<%= month_calendar(events: @events) do |date, events| %>
				<%= date.day %>

				<% events.each do |event| %>
					<div class="border">
						<%= link_to event_path(event) do %>
							<button class="enroll-btn btn btn-block calendar-link-<%= @colors.index(event.id) %>" type="button"><%= event.title %></button>
						<% end %>
					</div>
				<% end %>
			<% end %>
		</div>
  </div>
</div>
